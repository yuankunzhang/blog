<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Setting Up a Development Machine - yuankun@net: ~$</title><meta name=Description content="Always do what you're afraid to do"><meta property="og:title" content="Setting Up a Development Machine"><meta property="og:description" content="Just a few days ago, I completed a home server build. Today I decided to have a clean OS reinstallation on my development machine due to several reasons:

Firstly, the root partition on this machine is nearing full capacity (thank you, my past self).
Secondly, I&rsquo;m consistently encountering __common_interrupt: 1.55 No irq handler for vector errors during system bootup. There&rsquo;s a thread in the Arch Forum discussing this issue. Despite my efforts to resolve it through various ombinations of kernel parameters as suggested in the thread, I have not succeeded. It appears that the only viable solution is a BIOS firmware upgrade.
Finally, there exists a paradoxical issue: I cannot decrypt the root partition without using my bluetooth keyboard, yet I cannot use my bluetooth keyboard until the root partition is decrypted and mounted (because the bluetooth driver sits in the root partition). This presents a typical chicken and egg problem. My current hack around is to use a wired USB keyboard to decrypt the root parition. However, I desperately want to abandon this workaround.


        
    "><meta property="og:type" content="article"><meta property="og:url" content="https://yuankun.me/posts/dev-machine-setup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-07T20:50:45+08:00"><meta property="article:modified_time" content="2021-07-07T20:50:45+08:00"><meta property="og:site_name" content="yuankun@net: ~$"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setting Up a Development Machine"><meta name=twitter:description content="Just a few days ago, I completed a home server build. Today I decided to have a clean OS reinstallation on my development machine due to several reasons:

Firstly, the root partition on this machine is nearing full capacity (thank you, my past self).
Secondly, I&rsquo;m consistently encountering __common_interrupt: 1.55 No irq handler for vector errors during system bootup. There&rsquo;s a thread in the Arch Forum discussing this issue. Despite my efforts to resolve it through various ombinations of kernel parameters as suggested in the thread, I have not succeeded. It appears that the only viable solution is a BIOS firmware upgrade.
Finally, there exists a paradoxical issue: I cannot decrypt the root partition without using my bluetooth keyboard, yet I cannot use my bluetooth keyboard until the root partition is decrypted and mounted (because the bluetooth driver sits in the root partition). This presents a typical chicken and egg problem. My current hack around is to use a wired USB keyboard to decrypt the root parition. However, I desperately want to abandon this workaround.


        
    "><meta name=application-name content="yuankun@net: ~$"><meta name=apple-mobile-web-app-title content="yuankun@net: ~$"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://yuankun.me/posts/dev-machine-setup/><link rel=prev href=https://yuankun.me/posts/home-server-setup/><link rel=next href=https://yuankun.me/posts/tty-terminal-console/><link rel=stylesheet href=/css/main.css><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Setting Up a Development Machine","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/yuankun.me\/posts\/dev-machine-setup\/"},"genre":"posts","keywords":"linux, arch, bluetooth","wordcount":488,"url":"https:\/\/yuankun.me\/posts\/dev-machine-setup\/","datePublished":"2021-07-07T20:50:45+08:00","dateModified":"2021-07-07T20:50:45+08:00","publisher":{"@type":"Organization","name":"yuankun"},"author":{"@type":"Person","name":"yuankun"},"description":""}</script><script src=//instant.page/5.2.0 defer type=module integrity=sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z></script></head><body header-desktop header-mobile><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e,window.isDark=window.theme!=="light"}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")],window.switchThemeEventSet=new Set</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="yuankun@net: ~$">yuankun@net: ~$</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Blog </a><a class=menu-item href=/about/>About </a><a class=menu-item href=/syscall64/>Linux x64 Syscalls </a><a class=menu-item href=/syscall32/>Linux x86 Syscalls </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="yuankun@net: ~$">yuankun@net: ~$</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/ title>Blog</a><a class=menu-item href=/about/ title>About</a><a class=menu-item href=/syscall64/ title>Linux x64 Syscalls</a><a class=menu-item href=/syscall32/ title>Linux x86 Syscalls</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Setting Up a Development Machine</h1><div class=post-meta><div class=post-meta-line><span class=post-author><span class="author fas fa-user-circle fa-fw"></span><a href=/ title=Author rel=author class=author>yuankun</a>
</span>&nbsp;<span class=post-category>included in </span>&nbsp;<span class=post-category>category <a href=/categories/linux/><i class="far fa-folder fa-fw"></i>linux</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-07-07>2021-07-07</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2021-07-07>2021-07-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;488 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;3 minutes&nbsp;</div></div><div class=content id=content><p>Just a few days ago, I completed a <a href=/posts/home-server-setup rel>home server build</a>. Today I decided to have a clean OS reinstallation on my development machine due to several reasons:</p><ul><li>Firstly, the root partition on this machine is nearing full capacity (thank you, my past self).</li><li>Secondly, I&rsquo;m consistently encountering <code>__common_interrupt: 1.55 No irq handler for vector</code> errors during system bootup. There&rsquo;s a thread in the Arch Forum discussing this issue. Despite my efforts to resolve it through various ombinations of kernel parameters as suggested in the thread, I have not succeeded. It appears that the only viable solution is a BIOS firmware upgrade.</li><li>Finally, there exists a paradoxical issue: I cannot decrypt the root partition without using my bluetooth keyboard, yet I cannot use my bluetooth keyboard until the root partition is decrypted and mounted (because the bluetooth driver sits in the root partition). This presents a typical chicken and egg problem. My current hack around is to use a wired USB keyboard to decrypt the root parition. However, I desperately want to abandon this workaround.</li></ul><p><figure><a class=lightgallery href=/img/keyboard-not-found-press-any-key.png title="Keyboard not found, press any key to continue&amp;hellip;" data-thumbnail=/img/keyboard-not-found-press-any-key.png><img loading=lazy src=/img/keyboard-not-found-press-any-key.png srcset="/img/keyboard-not-found-press-any-key.png, /img/keyboard-not-found-press-any-key.png 1.5x, /img/keyboard-not-found-press-any-key.png 2x" sizes=auto alt=/img/keyboard-not-found-press-any-key.png></a></figure></p><h2 id=bios-firmware-upgrade class=headerLink><a href=#bios-firmware-upgrade class=header-mark></a>BIOS Firmware Upgrade</h2><p><strong>Caution: flashing the motherboard BIOS is a high risk operation. Please ensure you have thoroughly read and understand the motherboard upgrade instructions before proceeding.</strong></p><p>The <a href=https://www.gigabyte.com/Motherboard/X570-AORUS-MASTER-rev-11-12#kf target=_blank rel="noopener noreferrer">Gigabyte X570 Aorus Master</a> motherboard that I&rsquo;m using offers a convenient <a href=https://www.gigabyte.com/MicroSite/121/tech_qflash.htm target=_blank rel="noopener noreferrer">Q-Flash utility</a> embedded in the ROM, which greatly simplifies the BIOS upgrading process. All I have to do is to download the latest firmware onto a USB drive and follow the instructions in the Q-Flash manual.</p><p><figure><a class=lightgallery href=/img/x570-aorus-master.png title="Gigabyte X570 Aorus Master is a powerful motherboard for AMD processors" data-thumbnail=/img/x570-aorus-master.png><img loading=lazy src=/img/x570-aorus-master.png srcset="/img/x570-aorus-master.png, /img/x570-aorus-master.png 1.5x, /img/x570-aorus-master.png 2x" sizes=auto alt=/img/x570-aorus-master.png></a></figure></p><h2 id=operating-system-reinstallation class=headerLink><a href=#operating-system-reinstallation class=header-mark></a>Operating System Reinstallation</h2><p>The installation process is not much different from <a href=/posts/home-server-setup#arch-linux-installation rel>the OS installation on my home server</a>, except that there is no need for a RAID configuration or remote disk unlocking.</p><p>However, I do want to have my bluetooth keyboard operational before the root partition is decrypted and mounted, thereby eliminating the need for a separate wired keyboard solely for the purpose of root partition decryption.</p><h2 id=activating-bluetooth-service-prior-to-disk-decryption class=headerLink><a href=#activating-bluetooth-service-prior-to-disk-decryption class=header-mark></a>Activating Bluetooth Service Prior to Disk Decryption</h2><p>To use bluetooth devices at this early stage, We need to bring the bluetooth service into the initramfs. Luckily, a <a href=https://github.com/irreleph4nt/mkinitcpio-bluetooth target=_blank rel="noopener noreferrer">mkinitcpio hook</a> designed for this specific purpose exists, thanks to the resourceful Arch Linux Community.</p><p>A few things to note about this hook:</p><ul><li>It does not work in conjunction with the <code>systemd</code> hook in <code>/etc/mkinitcpio.conf</code>.</li><li>The project README says that it has only been tested on installations that use <a href=https://wiki.archlinux.org/title/REFInd target=_blank rel="noopener noreferrer">rEFInd</a> as the boot loader. I&rsquo;m using <a href=https://wiki.archlinux.org/title/Systemd-boot target=_blank rel="noopener noreferrer">systemd-boot</a>, formerly known as gummiboot, and this hook functions perfectly fine in this environment.</li></ul><p>We want the bluetooth adapter to power up automatically post-boot. Therefore, I need to add the line <code>AutoEnable=true</code> to the <code>Policy</code> section in the bluetooth adapter configuration file <code>/etc/bluetooth/main.conf</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># In /etc/bluetooth/main.conf
</span></span><span class=line><span class=cl>[Policy]
</span></span><span class=line><span class=cl>AutoEnable=true
</span></span></code></pre></div><p>Of course, the initial pairing of the bluetooth keyboard with the system needs to be performed manually. This is a one-time requirement. From the subsequent reboot onward, my keyboard will be fully functional just before I&rsquo;m prompted to enter the disk decryption key.</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2021-07-07</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/linux/>linux</a>,&nbsp;<a href=/tags/arch/>arch</a>,&nbsp;<a href=/tags/bluetooth/>bluetooth</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/home-server-setup/ class=prev rel=prev title="Setting Up a Home Server"><i class="fas fa-angle-left fa-fw"></i>Setting Up a Home Server</a>
<a href=/posts/tty-terminal-console/ class=next rel=next title=TTY、终端和控制台：历史、用途和区别>TTY、终端和控制台：历史、用途和区别<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=utterances></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://utteranc.es/>Utterances</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.113.0">Hugo</a>&nbsp;|&nbsp;Theme - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreferrer" title="DoIt 0.3.0"><i class="far fa-edit fa-fw"></i> DoIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">yuankun</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{utterances:{darkTheme:"github-dark",issueTerm:"pathname",label:"comment",lightTheme:"github-light",repo:"yuankunzhang/blog"}}}</script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=/js/utterances.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-ZXQSK4ST20")</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-ZXQSK4ST20" async></script></div></body></html>