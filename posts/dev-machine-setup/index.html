<!doctype html><html lang=en><head><title>Setup a Development Machine · yuankun@net $</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Yuankun Zhang"><meta name=description content="A few days ago, I did a home server build. Today I want to have a clean OS reinstallation on my development machine, because of a few things:

The root partition on this machine is almost full (thank you, my two years ago self).
I got a lot of __common_interrupt: 1.55 No irq handler for vector errors during the system bootup. There&rsquo;s a thread in the Arch Forum discussing this issue. I tried booting up the system with several different combinations of kernel parameters mentioned in the thread, but none helped. It seems like the only working solution is to upgrade the BIOS firmware.
I cannot decrypt the root partition without using my bluetooth keyboard, in the meantime I cannot use my bluetooth keyboard before the root partition is decrypted and mounted (because the bluetooth service sits in the root partition). This is a chicken-egg problem. My current hack around is to use a wired USB keyboard to decrypt the root parition. But I desperately want to eliminate the use of this USB keyboard.

"><meta name=keywords content="code,read,life"><meta name=twitter:card content="summary"><meta name=twitter:title content="Setup a Development Machine"><meta name=twitter:description content="A few days ago, I did a home server build. Today I want to have a clean OS reinstallation on my development machine, because of a few things:

The root partition on this machine is almost full (thank you, my two years ago self).
I got a lot of __common_interrupt: 1.55 No irq handler for vector errors during the system bootup. There&rsquo;s a thread in the Arch Forum discussing this issue. I tried booting up the system with several different combinations of kernel parameters mentioned in the thread, but none helped. It seems like the only working solution is to upgrade the BIOS firmware.
I cannot decrypt the root partition without using my bluetooth keyboard, in the meantime I cannot use my bluetooth keyboard before the root partition is decrypted and mounted (because the bluetooth service sits in the root partition). This is a chicken-egg problem. My current hack around is to use a wired USB keyboard to decrypt the root parition. But I desperately want to eliminate the use of this USB keyboard.

"><meta property="og:title" content="Setup a Development Machine"><meta property="og:description" content="A few days ago, I did a home server build. Today I want to have a clean OS reinstallation on my development machine, because of a few things:

The root partition on this machine is almost full (thank you, my two years ago self).
I got a lot of __common_interrupt: 1.55 No irq handler for vector errors during the system bootup. There&rsquo;s a thread in the Arch Forum discussing this issue. I tried booting up the system with several different combinations of kernel parameters mentioned in the thread, but none helped. It seems like the only working solution is to upgrade the BIOS firmware.
I cannot decrypt the root partition without using my bluetooth keyboard, in the meantime I cannot use my bluetooth keyboard before the root partition is decrypted and mounted (because the bluetooth service sits in the root partition). This is a chicken-egg problem. My current hack around is to use a wired USB keyboard to decrypt the root parition. But I desperately want to eliminate the use of this USB keyboard.

"><meta property="og:type" content="article"><meta property="og:url" content="https://yuankun.me/posts/dev-machine-setup/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-07T20:50:45+08:00"><meta property="article:modified_time" content="2021-07-07T20:50:45+08:00"><link rel=canonical href=https://yuankun.me/posts/dev-machine-setup/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.85656f585fe601450b123ec7c9a997f8488faf7f9e2c81913580c9e2f8c72f82.css integrity="sha256-hWVvWF/mAUULEj7HyamX+EiPr3+eLIGRNYDJ4vjHL4I=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.75de71d89fefe379cc001b6f6435f9b06dad86408428254718b48a73ea6d9e5e.css integrity="sha256-dd5x2J/v43nMABtvZDX5sG2thkCEKCVHGLSKc+ptnl4=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>yuankun@net $</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://yuankun.me/posts/dev-machine-setup/>Setup a Development Machine</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-07-07T20:50:45+08:00>July 7, 2021</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/linux/>linux</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/linux/>linux</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/arch/>arch</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/bluetooth/>bluetooth</a></span></div></div></header><div class=post-content><p>A few days ago, I did a <a href=/posts/home-server-setup>home server build</a>. Today I want to have a clean OS reinstallation on my development machine, because of a few things:</p><ul><li>The root partition on this machine is almost full (thank you, my two years ago self).</li><li>I got a lot of <code>__common_interrupt: 1.55 No irq handler for vector</code> errors during the system bootup. There&rsquo;s a thread in the Arch Forum discussing this issue. I tried booting up the system with several different combinations of kernel parameters mentioned in the thread, but none helped. It seems like the only working solution is to upgrade the BIOS firmware.</li><li>I cannot decrypt the root partition without using my bluetooth keyboard, in the meantime I cannot use my bluetooth keyboard before the root partition is decrypted and mounted (because the bluetooth service sits in the root partition). This is a chicken-egg problem. My current hack around is to use a wired USB keyboard to decrypt the root parition. But I desperately want to eliminate the use of this USB keyboard.</li></ul><p><img src=/img/keyboard-not-found-press-any-key.png alt="Keyboard not found, press any key to continue&amp;hellip;"></p><h2 id=upgrade-bios-firmware>Upgrade BIOS Firmware
<a class=heading-link href=#upgrade-bios-firmware><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><strong>A word of warning: flashing motherboard BIOS is a dangerous operation. Make sure you read the motherboard manual thoroughly.</strong></p><p>I&rsquo;m using a <a href=https://www.gigabyte.com/Motherboard/X570-AORUS-MASTER-rev-11-12#kf class=external-link target=_blank rel=noopener>Gigabyte X570 Aorus Master</a> motherboard for this machine. It has a handy <a href=https://www.gigabyte.com/MicroSite/121/tech_qflash.htm class=external-link target=_blank rel=noopener>Q-Flash utility</a> embedded in the ROM that simplifies the entire BIOS upgrading task. All I have to do is to download the latest firmware into a USB driver and follow the Q-Flash manual.</p><p><img src=/img/x570-aorus-master.png alt="Gigabyte X570 Aorus Master is a powerful motherboard for AMD processors"></p><h2 id=reinstall-the-operating-system>Reinstall the Operating System
<a class=heading-link href=#reinstall-the-operating-system><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>The installation process is not much different from <a href=/posts/home-server-setup#arch-linux-installation>the OS installation on my home server</a>, except that I don&rsquo;t need a RAID and I don&rsquo;t need to remote unlock the disk.</p><p>But I do want to have my bluetooth keyboard available before the root partition gets decrypted and mounted, so I don&rsquo;t need to use a second wired keyboard only for the purpose of root partition decryption.</p><h2 id=enable-bluetooth-service-before-disk-decryption>Enable Bluetooth Service before Disk Decryption
<a class=heading-link href=#enable-bluetooth-service-before-disk-decryption><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>To be able to use bluetooth devices at this stage, We need to bring the bluetooth service into the initramfs. Thankfully, someone has created a <a href=https://github.com/irreleph4nt/mkinitcpio-bluetooth class=external-link target=_blank rel=noopener>mkinitcpio hook</a> exactly for this purpose (kudos to the Arch Linux Community again).</p><p>Some notes on this hook:</p><ul><li>It does not work together with the <code>systemd</code> hook in <code>/etc/mkinitcpio.conf</code>.</li><li>The project README says that it has only been tested on installation that uses <a href=https://wiki.archlinux.org/title/REFInd class=external-link target=_blank rel=noopener>rEFInd</a> as boot loader. I&rsquo;m using <a href=https://wiki.archlinux.org/title/Systemd-boot class=external-link target=_blank rel=noopener>systemd-boot</a> (previously called gummiboot), and this hook works just fine.</li></ul><p>We want the bluetooth adapter to be auto powered after boot. So I need to add the line <code>AutoEnable=true</code> to the <code>Policy</code> section in the bluetooth adapter configuration file <code>/etc/bluetooth/main.conf</code>:</p><pre tabindex=0><code class=language-conf data-lang=conf># In /etc/bluetooth/main.conf
[Policy]
AutoEnable=true
</code></pre><p>And of course to pair the bluetooth keyboard with the system for the first time, I need to do it manually. This is a one-off task. Upon next reboot, my keyboard becomes functional just before I&rsquo;m asked to input the disk decryption key.</p></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme");getTheme=getTheme??"github-light";let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","yuankunzhang/blog"),s.setAttribute("issue-term","pathname"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2023
Yuankun Zhang
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>