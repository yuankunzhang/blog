<!doctype html><html lang=en><head><title>A Guide on Running Alpine Linux in QEMU · yuankun@net $</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Yuankun Zhang"><meta name=description content="How to run a Linux operating system in QEMU."><meta name=keywords content="code,read,life"><meta name=twitter:card content="summary"><meta name=twitter:title content="A Guide on Running Alpine Linux in QEMU"><meta name=twitter:description content="How to run a Linux operating system in QEMU."><meta property="og:title" content="A Guide on Running Alpine Linux in QEMU"><meta property="og:description" content="How to run a Linux operating system in QEMU."><meta property="og:type" content="article"><meta property="og:url" content="https://yuankun.me/posts/a-guide-on-running-alpine-linux-in-qemu/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-14T09:41:41+08:00"><meta property="article:modified_time" content="2020-03-14T09:41:41+08:00"><link rel=canonical href=https://yuankun.me/posts/a-guide-on-running-alpine-linux-in-qemu/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.85656f585fe601450b123ec7c9a997f8488faf7f9e2c81913580c9e2f8c72f82.css integrity="sha256-hWVvWF/mAUULEj7HyamX+EiPr3+eLIGRNYDJ4vjHL4I=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.75de71d89fefe379cc001b6f6435f9b06dad86408428254718b48a73ea6d9e5e.css integrity="sha256-dd5x2J/v43nMABtvZDX5sG2thkCEKCVHGLSKc+ptnl4=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>yuankun@net $</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://yuankun.me/posts/a-guide-on-running-alpine-linux-in-qemu/>A Guide on Running Alpine Linux in QEMU</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-03-14T09:41:41+08:00>March 14, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/linux/>linux</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/qemu/>qemu</a></span></div></div></header><div class=post-content><p>How to run a Linux operating system in QEMU.</p><h2 id=a-very-brief-introduction-to-qemu>A Very Brief Introduction to QEMU
<a class=heading-link href=#a-very-brief-introduction-to-qemu><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p><a href=https://www.qemu.org class=external-link target=_blank rel=noopener>QEMU</a> (Quick EMUlator) is a generic and open source machine emulator originally developed by <a href=https://bellard.org/ class=external-link target=_blank rel=noopener>Fabrice Bellard</a> (this same guy is also the original author of FFMPEG, insanely). It is a powerful and versatile tool that has gained widespread recognition and adoption in the world of virtualization. It provides a platform for creating and managing virtual machines, enabling users to emulate various hardware architectures, operating systems, and software environments.</p><p>One of the notable features of QEMU is its ability to provide full system emulation, allowing users to run unmodified guest operating systems on different host platforms. Additionally, QEMU supports a variety of virtualization techniques, such as hardware-assisted virtualization (e.g., Intel VT-x, AMD-V) and software based emulation, providing a range of options for running virtual machines efficiently.</p><p>QEMU also includes a suite of user-level emulation modes, enabling users to run software applications compiled for a different architecture without the need for complete system emulation. This feature is particularly useful for software developers who need to test their applications on different platforms without the overhead of running a full virtual machine.</p><p>Furthermose, QEMU integrates with the popular KVM hypervisor on Linux, allowing it to take advantages of hardware virtualization extensions and deliver near-native performance for virtualized workloads. This combination of QEMU and KVM has become a robust and widely adopted solution for virtualization in cloud computing environments.</p><h2 id=running-alpine-linux-in-qemu>Running Alpine Linux in QEMU
<a class=heading-link href=#running-alpine-linux-in-qemu><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Let&rsquo;s start by downloading the Alpine Linux installation media.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#79c0ff>ALPINE_VERSION</span><span style=color:#ff7b72;font-weight:700>=</span>v3.11.3
</span></span><span style=display:flex><span>wget <span style=color:#a5d6ff>&#34;http://dl-cdn.alpinelinux.org/alpine/</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>ALPINE_VERSION</span>%.*<span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>/releases/x86_64/alpine-standard-</span><span style=color:#a5d6ff>${</span><span style=color:#79c0ff>ALPINE_VERSION</span><span style=color:#a5d6ff>}</span><span style=color:#a5d6ff>-x86_64.iso&#34;</span>
</span></span></code></pre></div><p>Next, we craft a virtual hard drive for out Linux virtual machine. QEMU supports a long <a href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-using_qemu_img-supported_qemu_img_formats class=external-link target=_blank rel=noopener>list of image formats</a>. Among those, qcow2 is the most versatile format with the best feature set. We are going to use qcow2 format for our virtual machine.</p><p>We declare the size to be 10G, but note that only the written sectors will reserve space. The actual size of this file is much smaller.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ qemu-img create -f qcow2 alpine.qcow2 10G
</span></span></code></pre></div><p>Having ticked off the preparation checklist, we can now boot the installation media.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ qemu-system-x86_64 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -enable-kvm <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -m <span style=color:#a5d6ff>2048</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -smp <span style=color:#79c0ff>cores</span><span style=color:#ff7b72;font-weight:700>=</span>2,threads<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>4</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -nic user <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -drive <span style=color:#79c0ff>file</span><span style=color:#ff7b72;font-weight:700>=</span>alpine.qcow2,media<span style=color:#ff7b72;font-weight:700>=</span>disk <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -cdrom alpine-standard-3.11.3-x86_64.iso
</span></span></code></pre></div><p>The options are explained as:</p><ul><li><code>-enable-kvm</code>: Utilizes KVM when running a target architecture that mirrors the host architecture, allowing the guest machine to take advantage of KVM acceleration.</li><li><code>-m 2048</code>: Allocates 2GB memory to the guest machine.</li><li><code>-smp cores=2,threads=4</code>: Specify the number of CPU cores and threads to utilize.</li><li><code>-nic user</code>: Appends a virtual network interface controller to the guest machine. Learn more in this <a href=https://www.qemu.org/2018/05/31/nic-parameter/ class=external-link target=_blank rel=noopener>article</a>.</li><li><code>-drive file=alpine.qcow2,media=disk</code>: Attaches the newly created virtual hard drive to guest machine. The virtual hard drive will be mounted at <code>/dev/vda</code>.</li><li><code>-cdrom alpine-standard-3.11.3-x86_64.iso</code>: Attaches a virtual CDROM drive and loads the Alpine Linux installation media into it.</li></ul><p>Post the Alpine installation onto the hard drive, booting can be proceed without the <code>-cdrom</code> option.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ qemu-system-x86_64 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -enable-kvm <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -m <span style=color:#a5d6ff>2048</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -nic user <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -drive <span style=color:#79c0ff>file</span><span style=color:#ff7b72;font-weight:700>=</span>alpine.qcow2,media<span style=color:#ff7b72;font-weight:700>=</span>disk
</span></span></code></pre></div></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme");getTheme=getTheme??"github-light";let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","yuankunzhang/blog"),s.setAttribute("issue-term","pathname"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2023
Yuankun Zhang
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>