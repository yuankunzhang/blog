<!doctype html><html lang=en itemscope itemtype=http://schema.org/WebPage>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<title>Running Alpine Linux in QEMU - Yuankun's Blog</title>
<meta name=description content="How to run a Linux operating system in QEMU.">
<meta name=author content="Yuankun Zhang"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Yuankun\u0027s Blog","url":"https:\/\/yuankun.me"}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Organization","name":"","url":"https:\/\/yuankun.me"}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/yuankun.me","name":"home"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/yuankun.me\/posts\/running-alpine-linux-in-qemu\/","name":"Running alpine linux in qemu"}}]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"Article","author":{"name":"Yuankun Zhang"},"headline":"Running Alpine Linux in QEMU","description":"How to run a Linux operating system in QEMU.\n","inLanguage":"en","wordCount":463,"datePublished":"2020-03-14T09:41:41","dateModified":"2020-03-14T09:41:41","image":"https:\/\/yuankun.me\/img\/avatar-icon.png","keywords":["linux, qemu"],"mainEntityOfPage":"https:\/\/yuankun.me\/posts\/running-alpine-linux-in-qemu\/","publisher":{"@type":"Organization","name":"https:\/\/yuankun.me","logo":{"@type":"ImageObject","url":"https:\/\/yuankun.me\/img\/avatar-icon.png","height":60,"width":60}}}</script>
<meta property="og:title" content="Running Alpine Linux in QEMU">
<meta property="og:description" content="How to run a Linux operating system in QEMU.">
<meta property="og:image" content="https://yuankun.me/img/avatar-icon.png">
<meta property="og:url" content="https://yuankun.me/posts/running-alpine-linux-in-qemu/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="Yuankun's Blog">
<meta name=twitter:title content="Running Alpine Linux in QEMU">
<meta name=twitter:description content="How to run a Linux operating system in QEMU.">
<meta name=twitter:image content="https://yuankun.me/img/avatar-icon.png">
<meta name=twitter:card content="summary">
<link href=https://yuankun.me/img/favicon.ico rel=icon type=image/x-icon>
<meta name=generator content="Hugo 0.91.2">
<link rel=alternate href=https://yuankun.me/index.xml type=application/rss+xml title="Yuankun's Blog"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css integrity=sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y crossorigin=anonymous>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.5.0/css/all.css integrity=sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU crossorigin=anonymous>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://yuankun.me/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">
<link rel=stylesheet href=https://yuankun.me/css/highlight.min.css><link rel=stylesheet href=https://yuankun.me/css/codeblock.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css integrity=sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh crossorigin=anonymous>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css integrity=sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R crossorigin=anonymous>
</head>
<body>
<nav class="navbar navbar-default navbar-fixed-top navbar-custom">
<div class=container-fluid>
<div class=navbar-header>
<button type=button class=navbar-toggle data-toggle=collapse data-target=#main-navbar>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span>
</button>
<a class=navbar-brand href=https://yuankun.me>Yuankun's Blog</a>
</div>
<div class="collapse navbar-collapse" id=main-navbar>
<ul class="nav navbar-nav navbar-right">
<li>
<a title=Blog href=/>Blog</a>
</li>
<li>
<a title=About href=/page/about/>About</a>
</li>
<li>
<a title=Tags href=/tags>Tags</a>
</li>
</ul>
</div>
<div class=avatar-container>
<div class=avatar-img-border>
<a title="Yuankun's Blog" href=https://yuankun.me>
<img class=avatar-img src=https://yuankun.me/img/avatar-icon.png alt="Yuankun's Blog">
</a>
</div>
</div>
</div>
</nav>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div>
<header class=header-section>
<div class="intro-header no-img">
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class=posts-heading>
<h1>Running Alpine Linux in QEMU</h1>
<hr class=small>
</div>
</div>
</div>
</div>
</div>
</header>
<div class=container role=main>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<article role=main class=blog-post>
<p>How to run a Linux operating system in QEMU.</p>
<h2 id=qemu-a-very-short-introduction>QEMU: a very short introduction</h2>
<p>According to its <a href=https://www.qemu.org>official site</a>, QEMU is a generic and open source machine emulator and virtualizer.</p>
<p>QEMU works in one of the two operating modes:</p>
<ul>
<li><strong>Full system emulation</strong>. In this mode, QEMU emulates a full system, including processors and peripherals. It can be used to launch virtual guest operating systems.</li>
<li><strong>User mode emulation</strong>. In this mode, QEMU can launch processes that were compiled for a different instruction set.</li>
</ul>
<p>Futhermore, you can provision the <code>-enable-kvm</code> option to leverage Linux KVM. With this option, QEMU deals with the setting up and migration of KVM images and emulates hardwares, and the execution of the guest is done by KVM as requested by QEMU.</p>
<p>QEMU supports a long <a href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-using_qemu_img-supported_qemu_img_formats>list of disk image formats</a>, including the most popular two:</p>
<ul>
<li>Raw images (<code>.img</code>). This can be the fastest file-based format. If your file system supports holes, then only the written sectors will reserve space. Use <code>qemu-img info</code> or <code>ls -ls</code> to obtain the real size used by the image. Although raw images give optimal performance, only very basic features are available.</li>
<li>QEMU copy on write (<code>.qcow2</code>). This is the most versatile format with advanced feature set. But the feature set comes at the cost of performance.</li>
</ul>
<h2 id=running-alpine-linux-in-qemu>Running Alpine Linux in QEMU</h2>
<p>Let&rsquo;s start by downloading the Alpine Linux installation media.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ wget http://dl-cdn.alpinelinux.org/alpine/v3.11/releases/x86_64/alpine-standard-3.11.3-x86_64.iso
</code></pre></div><p>Create a virtual hard drive for the Linux machine. We declare the size to be 10G, but note that only the written sectors will reserve space. The actual size of this file is much smaller.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ qemu-img create -f qcow2 alpine.qcow2 10G
</code></pre></div><p>That&rsquo;s all we need for preparation. Now let&rsquo;s move on to boot the installation media.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ qemu-system-x86_64 <span class=se>\
</span><span class=se></span>    -enable-kvm <span class=se>\
</span><span class=se></span>    -m <span class=m>2048</span> <span class=se>\
</span><span class=se></span>    -smp <span class=nv>cores</span><span class=o>=</span>2,threads<span class=o>=</span><span class=m>4</span> <span class=se>\
</span><span class=se></span>    -nic user <span class=se>\
</span><span class=se></span>    -drive <span class=nv>file</span><span class=o>=</span>alpine.qcow2,media<span class=o>=</span>disk <span class=se>\
</span><span class=se></span>    -cdrom alpine-standard-3.11.3-x86_64.iso
</code></pre></div><ul>
<li><code>-enable-kvm</code>: Make use of KVM when running a target architecture that is the same as the host architecture. The guest machine can then take advantage of the KVM acceleration.</li>
<li><code>-m 2048</code>: Allocate 2GB memory to guest machine.</li>
<li><code>-smp cores=2,threads=4</code>: Specify the number of CPU cores and threads to use.</li>
<li><code>-nic user</code>: Add a virtual network interface controller to guest machine. More in this <a href=https://www.qemu.org/2018/05/31/nic-parameter/>article</a>.</li>
<li><code>-drive file=alpine.qcow2,media=disk</code>: Attach the newly created virtual hard drive to guest machine. The virtual hard drive will be mounted at <code>/dev/vda</code>.</li>
<li><code>-cdrom alpine-standard-3.11.3-x86_64.iso</code>: Attach a virtual CDROM drive and load Alpine Linux installation media into it.</li>
</ul>
<p>After installing Alpine Linux to the hard drive, we can boot without the <code>-cdrom</code> option.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh>$ qemu-system-x86_64 <span class=se>\
</span><span class=se></span>    -enable-kvm <span class=se>\
</span><span class=se></span>    -m <span class=m>2048</span> <span class=se>\
</span><span class=se></span>    -nic user <span class=se>\
</span><span class=se></span>    -drive <span class=nv>file</span><span class=o>=</span>alpine.qcow2,media<span class=o>=</span>disk
</code></pre></div><p>I&rsquo;m impressed by the flexibility and versatility of QEMU (of course this may come as a downside to some people because there are tons of options to choose).</p>
<div class=blog-tags>
<a href=https://yuankun.me/tags/linux/>linux</a>&nbsp;
<a href=https://yuankun.me/tags/qemu/>qemu</a>&nbsp;
</div>
<h4 class=see-also>See also</h4>
<ul>
<li><a href=/posts/dev-machine-setup/>My Dev Machine Setup</a></li>
<li><a href=/posts/home-server-setup/>My Home Server Setup</a></li>
<li><a href=/posts/debug-linux-kernel-with-qemu-and-gdb/>Debug Linux Kernel With QEMU and GDB</a></li>
<li><a href=/posts/running-raw-linux-kernel-in-qemu/>Running Raw Linux Kernel in QEMU</a></li>
</ul>
</article>
<ul class="pager blog-pager">
<li class=previous>
<a href=https://yuankun.me/posts/publishing-subdirectory-to-github-pages/ data-toggle=tooltip data-placement=top title="Publishing Subdirectory to Github Pages">&larr; Previous Post</a>
</li>
<li class=next>
<a href=https://yuankun.me/posts/running-raw-linux-kernel-in-qemu/ data-toggle=tooltip data-placement=top title="Running Raw Linux Kernel in QEMU">Next Post &rarr;</a>
</li>
</ul>
</div>
</div>
</div>
<footer>
<div class=container>
<div class=row>
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<ul class="list-inline text-center footer-links">
<li>
<a href=https://github.com/yuankunzhang title=GitHub>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-github fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://linkedin.com/in/yuankun-zhang-b1415b116 title=LinkedIn>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href=https://stackoverflow.com/users/756651/yuankun title=StackOverflow>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fab fa-stack-overflow fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
<li>
<a href title=RSS>
<span class="fa-stack fa-lg">
<i class="fas fa-circle fa-stack-2x"></i>
<i class="fas fa-rss fa-stack-1x fa-inverse"></i>
</span>
</a>
</li>
</ul>
<p class="credits copyright text-muted">
Yuankun Zhang
&nbsp;&bull;&nbsp;&copy;
2022
&nbsp;&bull;&nbsp;
<a href=https://yuankun.me>Yuankun's Blog</a>
</p>
<p class="credits theme-by text-muted">
<a href=https://gohugo.io>Hugo v0.91.2</a> powered &nbsp;&bull;&nbsp; Theme <a href=https://github.com/halogenica/beautifulhugo>Beautiful Hugo</a> adapted from <a href=https://deanattali.com/beautiful-jekyll/>Beautiful Jekyll</a>
</p>
</div>
</div>
</div>
</footer><script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js integrity=sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js integrity=sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe crossorigin=anonymous></script>
<script src=https://code.jquery.com/jquery-1.12.4.min.js integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script src=https://yuankun.me/js/main.js></script>
<script src=https://yuankun.me/js/highlight.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<script>$(document).ready(function(){$("pre.chroma").css("padding","0")})</script><script>renderMathInElement(document.body)</script><script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js integrity=sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js integrity=sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q crossorigin=anonymous></script><script src=https://yuankun.me/js/load-photoswipe.js></script>
</body>
</html>