<!doctype html><html lang=en><head><title>Running Alpine Linux in QEMU · yuankun@net $</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Yuankun Zhang"><meta name=description content="How to run a Linux operating system in QEMU."><meta name=keywords content="code,read,life"><meta name=twitter:card content="summary"><meta name=twitter:title content="Running Alpine Linux in QEMU"><meta name=twitter:description content="How to run a Linux operating system in QEMU."><meta property="og:title" content="Running Alpine Linux in QEMU"><meta property="og:description" content="How to run a Linux operating system in QEMU."><meta property="og:type" content="article"><meta property="og:url" content="https://yuankun.me/posts/running-alpine-linux-in-qemu/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-14T09:41:41+08:00"><meta property="article:modified_time" content="2020-03-14T09:41:41+08:00"><link rel=canonical href=https://yuankun.me/posts/running-alpine-linux-in-qemu/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.85656f585fe601450b123ec7c9a997f8488faf7f9e2c81913580c9e2f8c72f82.css integrity="sha256-hWVvWF/mAUULEj7HyamX+EiPr3+eLIGRNYDJ4vjHL4I=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.75de71d89fefe379cc001b6f6435f9b06dad86408428254718b48a73ea6d9e5e.css integrity="sha256-dd5x2J/v43nMABtvZDX5sG2thkCEKCVHGLSKc+ptnl4=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/img/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/img/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>yuankun@net $</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/about/>About</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://yuankun.me/posts/running-alpine-linux-in-qemu/>Running Alpine Linux in QEMU</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-03-14T09:41:41+08:00>March 14, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/linux/>linux</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/qemu/>qemu</a></span></div></div></header><div class=post-content><p>How to run a Linux operating system in QEMU.</p><h2 id=qemu-a-very-short-introduction>QEMU: a very short introduction
<a class=heading-link href=#qemu-a-very-short-introduction><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>According to its <a href=https://www.qemu.org class=external-link target=_blank rel=noopener>official site</a>, QEMU is a generic and open source machine emulator and virtualizer.</p><p>QEMU works in one of the two operating modes:</p><ul><li><strong>Full system emulation</strong>. In this mode, QEMU emulates a full system, including processors and peripherals. It can be used to launch virtual guest operating systems.</li><li><strong>User mode emulation</strong>. In this mode, QEMU can launch processes that were compiled for a different instruction set.</li></ul><p>Futhermore, you can provision the <code>-enable-kvm</code> option to leverage Linux KVM. With this option, QEMU deals with the setting up and migration of KVM images and emulates hardwares, and the execution of the guest is done by KVM as requested by QEMU.</p><p>QEMU supports a long <a href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/virtualization_deployment_and_administration_guide/sect-using_qemu_img-supported_qemu_img_formats class=external-link target=_blank rel=noopener>list of disk image formats</a>, including the most popular two:</p><ul><li>Raw images (<code>.img</code>). This can be the fastest file-based format. If your file system supports holes, then only the written sectors will reserve space. Use <code>qemu-img info</code> or <code>ls -ls</code> to obtain the real size used by the image. Although raw images give optimal performance, only very basic features are available.</li><li>QEMU copy on write (<code>.qcow2</code>). This is the most versatile format with advanced feature set. But the feature set comes at the cost of performance.</li></ul><h2 id=running-alpine-linux-in-qemu>Running Alpine Linux in QEMU
<a class=heading-link href=#running-alpine-linux-in-qemu><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Let&rsquo;s start by downloading the Alpine Linux installation media.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ wget http://dl-cdn.alpinelinux.org/alpine/v3.11/releases/x86_64/alpine-standard-3.11.3-x86_64.iso
</span></span></code></pre></div><p>Create a virtual hard drive for the Linux machine. We declare the size to be 10G, but note that only the written sectors will reserve space. The actual size of this file is much smaller.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ qemu-img create -f qcow2 alpine.qcow2 10G
</span></span></code></pre></div><p>That&rsquo;s all we need for preparation. Now let&rsquo;s move on to boot the installation media.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ qemu-system-x86_64 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -enable-kvm <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -m <span style=color:#a5d6ff>2048</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -smp <span style=color:#79c0ff>cores</span><span style=color:#ff7b72;font-weight:700>=</span>2,threads<span style=color:#ff7b72;font-weight:700>=</span><span style=color:#a5d6ff>4</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -nic user <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -drive <span style=color:#79c0ff>file</span><span style=color:#ff7b72;font-weight:700>=</span>alpine.qcow2,media<span style=color:#ff7b72;font-weight:700>=</span>disk <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -cdrom alpine-standard-3.11.3-x86_64.iso
</span></span></code></pre></div><ul><li><code>-enable-kvm</code>: Make use of KVM when running a target architecture that is the same as the host architecture. The guest machine can then take advantage of the KVM acceleration.</li><li><code>-m 2048</code>: Allocate 2GB memory to guest machine.</li><li><code>-smp cores=2,threads=4</code>: Specify the number of CPU cores and threads to use.</li><li><code>-nic user</code>: Add a virtual network interface controller to guest machine. More in this <a href=https://www.qemu.org/2018/05/31/nic-parameter/ class=external-link target=_blank rel=noopener>article</a>.</li><li><code>-drive file=alpine.qcow2,media=disk</code>: Attach the newly created virtual hard drive to guest machine. The virtual hard drive will be mounted at <code>/dev/vda</code>.</li><li><code>-cdrom alpine-standard-3.11.3-x86_64.iso</code>: Attach a virtual CDROM drive and load Alpine Linux installation media into it.</li></ul><p>After installing Alpine Linux to the hard drive, we can boot without the <code>-cdrom</code> option.</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ qemu-system-x86_64 <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -enable-kvm <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -m <span style=color:#a5d6ff>2048</span> <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -nic user <span style=color:#79c0ff>\
</span></span></span><span style=display:flex><span><span style=color:#79c0ff></span>    -drive <span style=color:#79c0ff>file</span><span style=color:#ff7b72;font-weight:700>=</span>alpine.qcow2,media<span style=color:#ff7b72;font-weight:700>=</span>disk
</span></span></code></pre></div><p>I&rsquo;m impressed by the flexibility and versatility of QEMU (of course this may come as a downside to some people because there are tons of options to choose).</p></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme");getTheme=getTheme??"github-light";let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","yuankunzhang/blog"),s.setAttribute("issue-term","pathname"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>©
2019 -
2023
Yuankun Zhang
·
Powered by <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/ target=_blank rel=noopener>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>