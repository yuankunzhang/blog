<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
	<title>Yuankun&#x27;s Blog - bluetooth</title>
	<subtitle>Journey to explore the unknown.</subtitle>
	<link href="https://yuankun.me/tags/bluetooth/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="https://yuankun.me"/>
	<generator uri="https://www.getzola.org/">Zola</generator>
	<updated>2021-07-07T00:00:00+00:00</updated>
	<id>https://yuankun.me/tags/bluetooth/atom.xml</id>
	<entry xml:lang="en">
		<title>Reinstall OS on My Dev Machine</title>
		<published>2021-07-07T00:00:00+00:00</published>
		<updated>2021-07-07T00:00:00+00:00</updated>
		<link href="https://yuankun.me/reinstall-os-on-dev-machine/" type="text/html"/>
		<id>https://yuankun.me/reinstall-os-on-dev-machine/</id>
		<content type="html">&lt;p&gt;A few days ago, I had a &lt;a href=&quot;&#x2F;home-server-setup&quot;&gt;home server setup&lt;&#x2F;a&gt;. Today I want to have a clean OS reinstallation on my development machine. The primary reason is that the root partition is almost full (due to a short-sightness when I first set the machine up). Apart from that, there are several other issues that I want to tackle:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;I got a lot of &lt;code&gt;__common_interrupt: 1.55 No irq handler for vector&lt;&#x2F;code&gt; errors during the system bootup. There&#x27;s a thread in the Arch Forum on this issue. I tried booting up the system with different kernel parameters, but none helped. Seems like the only solution is to upgrade the BIOS firmware.&lt;&#x2F;li&gt;
&lt;li&gt;I cannot use my bluetooth keyboard to input the root partition decryption key, because the bluetooth service is locked in the root partition. This is quite disturbing, everytime I restarted the machine, I had to plug in my USB wired keyboard just to type in the decryption key.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;span id=&quot;continue-reading&quot;&gt;&lt;&#x2F;span&gt;&lt;h2 id=&quot;upgrade-bios-firmware&quot;&gt;Upgrade BIOS Firmware&lt;&#x2F;h2&gt;
&lt;p&gt;&lt;strong&gt;A word of warning: flashing motherboard BIOS is a dangerous operation. Make sure you read the motherboard manual thoroughly.&lt;&#x2F;strong&gt;&lt;&#x2F;p&gt;
&lt;p&gt;I&#x27;m using a &lt;a href=&quot;https:&#x2F;&#x2F;www.gigabyte.com&#x2F;Motherboard&#x2F;X570-AORUS-MASTER-rev-11-12#kf&quot;&gt;Gigabyte X570 Aorus Master&lt;&#x2F;a&gt; motherboard for this machine. It has a handy &lt;a href=&quot;https:&#x2F;&#x2F;www.gigabyte.com&#x2F;MicroSite&#x2F;121&#x2F;tech_qflash.htm&quot;&gt;Q-Flash utility&lt;&#x2F;a&gt; embedded in the ROM. The firmware upgrading process is very easy, just follow the manual.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;reinstall-the-operating-system&quot;&gt;Reinstall the Operating System&lt;&#x2F;h2&gt;
&lt;p&gt;The installation is not much different from &lt;a href=&quot;&#x2F;home-server-setup#arch-linux-installation&quot;&gt;the OS installation on my home server&lt;&#x2F;a&gt;, except that I don&#x27;t need a RAID and I don&#x27;t need to remote unlock the disk.&lt;&#x2F;p&gt;
&lt;p&gt;But I do want to use my bluetooth keyboard to unlock the disk.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;enable-bluetooth-keyboard-before-disk-decryption&quot;&gt;Enable Bluetooth Keyboard before Disk Decryption&lt;&#x2F;h2&gt;
&lt;p&gt;We need to bring the bluetooth service into the initramfs. Thankfully, someone has created a &lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;irreleph4nt&#x2F;mkinitcpio-bluetooth&quot;&gt;mkinitcpio hook&lt;&#x2F;a&gt; for this purpose (kudos to the Arch Community).&lt;&#x2F;p&gt;
&lt;p&gt;Some notes on this hook:&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;It does not work together with the &lt;code&gt;systemd&lt;&#x2F;code&gt; hook.&lt;&#x2F;li&gt;
&lt;li&gt;The project README says that it has only been tested on installation that uses &lt;a href=&quot;https:&#x2F;&#x2F;wiki.archlinux.org&#x2F;title&#x2F;REFInd&quot;&gt;rEFInd&lt;&#x2F;a&gt; as boot loader. I&#x27;m using &lt;a href=&quot;https:&#x2F;&#x2F;wiki.archlinux.org&#x2F;title&#x2F;Systemd-boot&quot;&gt;systemd-boot&lt;&#x2F;a&gt; (previously called gummiboot), and this hook works just fine.&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;The bluetooth adapter needs to be auto powered on after boot. Add the line &lt;code&gt;AutoEnable=true&lt;&#x2F;code&gt; to the &lt;code&gt;Policy&lt;&#x2F;code&gt; section in the configuration file &lt;code&gt;&#x2F;etc&#x2F;bluetooth&#x2F;main.conf&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre style=&quot;background-color:#2b303b;&quot;&gt;
&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;# In &#x2F;etc&#x2F;bluetooth&#x2F;main.conf
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[Policy]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;AutoEnable&lt;&#x2F;span&gt;&lt;span style=&quot;color:#c0c5ce;&quot;&gt;=&lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;And I need to manually connect the bluetooth keyboard for a first time. Upon next reboot, my keyboard becomes functional just before I&#x27;m asked to input the disk decryption key.&lt;&#x2F;p&gt;
</content>
	</entry>
</feed>
