<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title>Reinstall OS on My Dev Machine &middot; Yuankun&#x27;s Blog</title>

      

      
          <script src="https://cdnjs.cloudflare.com/ajax/libs/slideout/1.0.1/slideout.min.js"></script>
          
      

      
          <link rel="stylesheet" href="https:&#x2F;&#x2F;yuankun.me&#x2F;site.css">
          
      

      
      
    </head>

    <body>
        <div class="container">

            <div id="mobile-navbar" class="mobile-navbar">
              <div class="mobile-header-logo">
                <a href="/" class="logo">Yuankun&#x27;s Blog</a>
              </div>
              <div class="mobile-navbar-icon icon-out">
                <span></span>
                <span></span>
                <span></span>
              </div>
            </div>

            <nav id="mobile-menu" class="mobile-menu slideout-menu slideout-menu-left">
              <ul class="mobile-menu-list">
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;yuankun.me">
                            Home
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;yuankun.me&#x2F;categories">
                            Categories
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;yuankun.me&#x2F;tags">
                            Tags
                        </a>
                    </li>
                
                    <li class="mobile-menu-item">
                        <a href="https:&#x2F;&#x2F;yuankun.me&#x2F;about">
                            About
                        </a>
                    </li>
                
              </ul>
            </nav>

            <header id="header">
                <div class="logo"><a href="https:&#x2F;&#x2F;yuankun.me">Yuankun&#x27;s Blog</a></div>
                <nav class="menu">
                    <ul>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;yuankun.me">
                                    Home
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;yuankun.me&#x2F;categories">
                                    Categories
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;yuankun.me&#x2F;tags">
                                    Tags
                                </a>
                            </li>
                        
                            <li>
                                <a href="https:&#x2F;&#x2F;yuankun.me&#x2F;about">
                                    About
                                </a>
                            </li>
                        
                    </ul>
                </nav>
            </header>

            <main>
                <div class="content" id="mobile-panel">
                    
<article>
  <h1>Reinstall OS on My Dev Machine</h1>

  
    <p style="font-size:90%;">Posted on <time datetime="2021-07-07T00:00:00+00:00">July 07, 2021</time></p>
  

  <p>A few days ago, I had a <a href="/home-server-setup">home server setup</a>. Today I want to have a clean OS reinstallation on my development machine. The primary reason is that the root partition is almost full (due to a short-sightness when I first set the machine up). Apart from that, there are several other issues that I want to tackle:</p>
<ul>
<li>I got a lot of <code>__common_interrupt: 1.55 No irq handler for vector</code> errors during the system bootup. There's a thread in the Arch Forum on this issue. I tried booting up the system with different kernel parameters, but none helped. Seems like the only solution is to upgrade the BIOS firmware.</li>
<li>I cannot use my bluetooth keyboard to input the root partition decryption key, because the bluetooth service is locked in the root partition. This is quite disturbing, everytime I restarted the machine, I had to plug in my USB wired keyboard just to type in the decryption key.</li>
</ul>
<span id="continue-reading"></span><h2 id="upgrade-bios-firmware">Upgrade BIOS Firmware</h2>
<p><strong>A word of warning: flashing motherboard BIOS is a dangerous operation. Make sure you read the motherboard manual thoroughly.</strong></p>
<p>I'm using a <a href="https://www.gigabyte.com/Motherboard/X570-AORUS-MASTER-rev-11-12#kf">Gigabyte X570 Aorus Master</a> motherboard for this machine. It has a handy <a href="https://www.gigabyte.com/MicroSite/121/tech_qflash.htm">Q-Flash utility</a> embedded in the ROM. The firmware upgrading process is very easy, just follow the manual.</p>
<h2 id="reinstall-the-operating-system">Reinstall the Operating System</h2>
<p>The installation is not much different from <a href="/home-server-setup#arch-linux-installation">the OS installation on my home server</a>, except that I don't need a RAID and I don't need to remote unlock the disk.</p>
<p>But I do want to use my bluetooth keyboard to unlock the disk.</p>
<h2 id="enable-bluetooth-keyboard-before-disk-decryption">Enable Bluetooth Keyboard before Disk Decryption</h2>
<p>We need to bring the bluetooth service into the initramfs. Thankfully, someone has created a <a href="https://github.com/irreleph4nt/mkinitcpio-bluetooth">mkinitcpio hook</a> for this purpose (kudos to the Arch Community).</p>
<p>Some notes on this hook:</p>
<ul>
<li>It does not work together with the <code>systemd</code> hook.</li>
<li>The project README says that it has only been tested on installation that uses <a href="https://wiki.archlinux.org/title/REFInd">rEFInd</a> as boot loader. I'm using <a href="https://wiki.archlinux.org/title/Systemd-boot">systemd-boot</a> (previously called gummiboot), and this hook works just fine.</li>
</ul>
<p>The bluetooth adapter needs to be auto powered on after boot. Add the line <code>AutoEnable=true</code> to the <code>Policy</code> section in the configuration file <code>/etc/bluetooth/main.conf</code>:</p>
<pre style="background-color:#2b303b;">
<code class="language-conf" data-lang="conf"><span style="color:#c0c5ce;"># In /etc/bluetooth/main.conf
</span><span style="color:#b48ead;">[Policy]
</span><span style="color:#bf616a;">AutoEnable</span><span style="color:#c0c5ce;">=</span><span style="color:#d08770;">true
</span></code></pre>
<p>And I need to manually connect the bluetooth keyboard for a first time. Upon next reboot, my keyboard becomes functional just before I'm asked to input the disk decryption key.</p>

</article>

<br />

<div class="utterances"></div>
<script src="https://utteranc.es/client.js"
        repo="yuankunzhang/blog"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

                </div>
            </main>

            
            
        </div>

      
          <script type="text/javascript" src="https:&#x2F;&#x2F;yuankun.me&#x2F;even.js" ></script>
      
    </body>

</html>
